<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTP相关 | Richard&#39;s Blob</title>
    <meta name="description" content="Richard&#39;s Blob">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    
    <link rel="preload" href="/assets/css/0.styles.6728d23b.css" as="style"><link rel="preload" href="/assets/js/app.6caa4709.js" as="script"><link rel="preload" href="/assets/js/2.c9ea1ab5.js" as="script"><link rel="preload" href="/assets/js/21.bf2918a1.js" as="script"><link rel="prefetch" href="/assets/js/10.36d81284.js"><link rel="prefetch" href="/assets/js/11.8f5fe32a.js"><link rel="prefetch" href="/assets/js/12.0a357011.js"><link rel="prefetch" href="/assets/js/13.73247ec9.js"><link rel="prefetch" href="/assets/js/14.7533f362.js"><link rel="prefetch" href="/assets/js/15.420f0a3e.js"><link rel="prefetch" href="/assets/js/16.e03e9297.js"><link rel="prefetch" href="/assets/js/17.0756bf10.js"><link rel="prefetch" href="/assets/js/18.59877593.js"><link rel="prefetch" href="/assets/js/19.94fb8b13.js"><link rel="prefetch" href="/assets/js/20.3012fcb9.js"><link rel="prefetch" href="/assets/js/22.43ad5de7.js"><link rel="prefetch" href="/assets/js/23.5a81ceec.js"><link rel="prefetch" href="/assets/js/24.f5605958.js"><link rel="prefetch" href="/assets/js/25.06eaebfb.js"><link rel="prefetch" href="/assets/js/26.6d9c7831.js"><link rel="prefetch" href="/assets/js/27.3c7fafc6.js"><link rel="prefetch" href="/assets/js/28.19a5df39.js"><link rel="prefetch" href="/assets/js/29.8790f4af.js"><link rel="prefetch" href="/assets/js/3.86ebf002.js"><link rel="prefetch" href="/assets/js/30.73c1de2f.js"><link rel="prefetch" href="/assets/js/31.249d39ed.js"><link rel="prefetch" href="/assets/js/32.ca0a3d2f.js"><link rel="prefetch" href="/assets/js/33.9a4aa370.js"><link rel="prefetch" href="/assets/js/4.d9420d8b.js"><link rel="prefetch" href="/assets/js/5.d2716c70.js"><link rel="prefetch" href="/assets/js/6.588ac311.js"><link rel="prefetch" href="/assets/js/7.03e528e9.js"><link rel="prefetch" href="/assets/js/8.15171aa5.js"><link rel="prefetch" href="/assets/js/9.3caa627c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6728d23b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo.png" alt="Richard's Blob" class="logo"> <span class="site-name can-hide">Richard's Blob</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">Welcome</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>algorithm</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/algorithm/力扣.html" class="sidebar-link">力扣</a></li><li><a href="/algorithm/某厂前端面试算法题.html" class="sidebar-link">某厂前端面试算法题目</a></li><li><a href="/algorithm/深度优先与广度优先.html" class="sidebar-link">深度优先与广度优先</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>browser</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/browser/cookie.html" class="sidebar-link">cookie CRUD</a></li><li><a href="/browser/HTTP.html" class="active sidebar-link">HTTP相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/browser/HTTP.html#http2新特性" class="sidebar-link">HTTP2新特性</a></li><li class="sidebar-sub-header"><a href="/browser/HTTP.html#如何升级http2" class="sidebar-link">如何升级HTTP2</a></li><li class="sidebar-sub-header"><a href="/browser/HTTP.html#https" class="sidebar-link">HTTPS</a></li><li class="sidebar-sub-header"><a href="/browser/HTTP.html#tcp三次握手过程" class="sidebar-link">TCP三次握手过程</a></li><li class="sidebar-sub-header"><a href="/browser/HTTP.html#tcp四次挥手" class="sidebar-link">TCP四次挥手</a></li></ul></li><li><a href="/browser/跨域.html" class="sidebar-link">跨域</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/CSS/animate.html" class="sidebar-link">animate动画</a></li><li><a href="/CSS/interview.html" class="sidebar-link">总结一些经典面试题</a></li><li><a href="/CSS/双飞翼布局.html" class="sidebar-link">双飞翼布局</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>git</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/git/常用命令.html" class="sidebar-link">常用命令</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaScript/event-loop.html" class="sidebar-link">事件循环</a></li><li><a href="/JavaScript/手撕Promise.html" class="sidebar-link">手撕Promise</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>miniprogram</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/miniprogram/content-security.html" class="sidebar-link">小程序内容安全</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>others</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/others/LPR.html" class="sidebar-link">LPR</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>react</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react/" class="sidebar-link">react</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue/Vue.html" class="sidebar-link">Vue</a></li><li><a href="/vue/VueRouter.html" class="sidebar-link">VueRouter</a></li><li><a href="/vue/Vuex.html" class="sidebar-link">Vuex</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/webpack/loader.html" class="sidebar-link">loader</a></li><li><a href="/webpack/plugin.html" class="sidebar-link">plugin</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Web安全</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Web安全/CSRF.html" class="sidebar-link">CSRF</a></li><li><a href="/Web安全/XSS.html" class="sidebar-link">XSS</a></li><li><a href="/Web安全/点击劫持.html" class="sidebar-link">点击劫持</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="http2新特性"><a href="#http2新特性" class="header-anchor">#</a> HTTP2新特性</h2> <h3 id="二进制分帧"><a href="#二进制分帧" class="header-anchor">#</a> 二进制分帧</h3> <h3 id="首部压缩"><a href="#首部压缩" class="header-anchor">#</a> 首部压缩</h3> <h3 id="流量控制"><a href="#流量控制" class="header-anchor">#</a> 流量控制</h3> <h3 id="多路复用"><a href="#多路复用" class="header-anchor">#</a> 多路复用</h3> <h3 id="请求优先级"><a href="#请求优先级" class="header-anchor">#</a> 请求优先级</h3> <h3 id="服务器推送"><a href="#服务器推送" class="header-anchor">#</a> 服务器推送</h3> <h2 id="如何升级http2"><a href="#如何升级http2" class="header-anchor">#</a> 如何升级HTTP2</h2> <p>TODO</p> <h2 id="https"><a href="#https" class="header-anchor">#</a> HTTPS</h2> <h3 id="https协议过程"><a href="#https协议过程" class="header-anchor">#</a> https协议过程</h3> <ol><li>爱丽丝给出协议版本号、一个客户端生成的随机数（Client random），以及客户端支持的加密方法。</li> <li>鲍勃确认双方使用的加密方法，并给出数字证书、以及一个服务器生成的随机数（Server random）。</li> <li>爱丽丝确认数字证书有效，然后生成一个新的随机数（Premaster secret），并使用数字证书中的公钥，加密这个随机数，发给鲍勃。</li> <li>鲍勃使用自己的私钥，获取爱丽丝发来的随机数（即Premaster secret）。</li> <li>爱丽丝和鲍勃根据约定的加密方法，使用前面的三个随机数，生成&quot;对话密钥&quot;（session key），用来加密接下来的整个对话过程。</li></ol> <h2 id="tcp三次握手过程"><a href="#tcp三次握手过程" class="header-anchor">#</a> TCP三次握手过程</h2> <img src="/images/three-way-handshake.jpg"> <h3 id="为啥需要三次"><a href="#为啥需要三次" class="header-anchor">#</a> 为啥需要三次?</h3> <blockquote><p>主要是为了防止失效的连接请求报文段突然又传送到了B, 因为产生错误</p></blockquote> <p>不用三次, 你的意思就是用两次咯? 总不能一次就行了吧? OK, 那就解释为啥子两次不行:</p> <p>假设一种情况, A发出了一个连接请求, 然后由于网络延迟卡在某个地方了, A的第一次请求发出去没有得到B的ACK确认, TCP不是有超时重发吗对吧? 所以A再一次发出去一个连接请求, 这次很正常, B收到连接请求, 回复A, A收到B的确认信号之后, 连接建立, 开始传送数据. 劈里啪啦, 一顿操作猛如虎, 数据传输完成, 连接断开, 各回各家, 各找各妈. 假设这个时候, 之前A一开始发出的那个卡壳的连接信号, 跨越山海, 终于千里迢迢风尘仆仆赶到了B, B就会误以为这是A又发出来的一个新的连接请求, 于是回复A, 当确认信号到达A的时候, A当然不理会B的这个确认请求, 心里还默默咒骂B是傻冒. 因为B在回复A之后, 就默认连接建立了, 在傻乎乎的占用系统的资源等待A进行数据传输. 说到这, 就已经能够推翻为啥子两次连接不行了吧~</p> <h2 id="tcp四次挥手"><a href="#tcp四次挥手" class="header-anchor">#</a> TCP四次挥手</h2> <img src="/images/four-way-wave.jfif"> <h3 id="为啥需要四次挥手"><a href="#为啥需要四次挥手" class="header-anchor">#</a> 为啥需要四次挥手?</h3> <blockquote><p>一句话: 不能像握手那样, 一次性回复ACK和FIN(握手是一次性回复ACK和SYN)</p></blockquote> <p>因为当Server端收到Client端的SYN连接请求报文后，可以直接发送SYN+ACK报文。其中ACK报文是用来应答的，SYN报文是用来同步的。但是关闭连接时，当Server端收到FIN报文时，很可能并不会立即关闭SOCKET，所以只能先回复一个ACK报文，告诉Client端，&quot;你发的FIN报文我收到了&quot;。只有等到我Server端所有的报文都发送完了，我才能发送FIN报文，因此不能一起发送。故需要四步握手。</p> <h3 id="为什么time-wait状态需要经过2msl-最大报文段生存时间-才能返回到close状态？"><a href="#为什么time-wait状态需要经过2msl-最大报文段生存时间-才能返回到close状态？" class="header-anchor">#</a> 为什么TIME_WAIT状态需要经过2MSL(最大报文段生存时间)才能返回到CLOSE状态？</h3> <blockquote><p>一句话: 需要确认server收到了client的ACK并关闭了</p></blockquote> <p>网络是不可靠的, 假设Client发出的最后一个ACK丢包了, 由于Server没有收到ACK, 会重发FIN报文. 所以, Client是不能立刻关闭的, 它必须确认Server收到了它的ACK. 否则, Server端可能永远关闭不了连接! Client会在发送出ACK之后进入到TIME_WAIT状态。Client会设置一个计时器，等待2MSL的时间。如果在该时间内再次收到FIN，那么Client会重发ACK并再次等待2MSL。所谓的2MSL是两倍的MSL(Maximum Segment Lifetime)。MSL指一个片段在网络中最大的存活时间，2MSL就是一个发送和一个回复所需的最大时间。如果直到2MSL，Client都没有再次收到FIN，那么Client推断ACK已经被成功接收，则结束TCP连接。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020-01-17 12:10:07</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/browser/cookie.html" class="prev">cookie CRUD</a></span> <span class="next"><a href="/browser/跨域.html">跨域</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.6caa4709.js" defer></script><script src="/assets/js/2.c9ea1ab5.js" defer></script><script src="/assets/js/21.bf2918a1.js" defer></script>
  </body>
</html>
